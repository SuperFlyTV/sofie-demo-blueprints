"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[776],{1917(e,t,n){n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>r,default:()=>h,frontMatter:()=>o,metadata:()=>i,toc:()=>l});const i=JSON.parse('{"id":"adlibs/adlib_actions/adlib_actions","title":"Creating a Global AdLib Action","description":"In this example we are creating a Global AdLib Action that can be executed any-time in the show.","source":"@site/docs/adlibs/adlib_actions/adlib_actions.md","sourceDirName":"adlibs/adlib_actions","slug":"/adlibs/adlib_actions/","permalink":"/sofie-demo-blueprints/docs/adlibs/adlib_actions/","draft":false,"unlisted":false,"editUrl":"https://github.com/SuperFlyTV/sofie-demo-blueprints/tree/docs/docusaurus/packages/docs/docs/docs/adlibs/adlib_actions/adlib_actions.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Global Adlibs","permalink":"/sofie-demo-blueprints/docs/adlibs/global_adlibs"},"next":{"title":"Trigger modes and dynamic data in AdLib Actions","permalink":"/sofie-demo-blueprints/docs/adlibs/adlib_actions/trigger_modes_and_dynamic_data"}}');var c=n(1085),a=n(1184);const s=n.p+"assets/images/steppedGlobalAdlib-c2b822883765e6dd4d10e7ba98e8b6da.gif",o={},r="Creating a Global AdLib Action",d={},l=[{value:"Step 1: Add a new ActionId",id:"step-1-add-a-new-actionid",level:2},{value:"Step 2: Create a global action to step through the graphic",id:"step-2-create-a-global-action-to-step-through-the-graphic",level:2},{value:"Step 3: Execution logic",id:"step-3-execution-logic",level:2},{value:"For our example we could choose from these approaches:",id:"for-our-example-we-could-choose-from-these-approaches",level:3},{value:"Result",id:"result",level:2}];function p(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,a.R)(),...e.components};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(t.header,{children:(0,c.jsx)(t.h1,{id:"creating-a-global-adlib-action",children:"Creating a Global AdLib Action"})}),"\n",(0,c.jsx)(t.p,{children:"In this example we are creating a Global AdLib Action that can be executed any-time in the show."}),"\n",(0,c.jsxs)(t.p,{children:["This example builds on the ",(0,c.jsx)(t.a,{href:"../piece_types/creating_piece_types",children:"stepped graphics piece we created here"})]}),"\n",(0,c.jsx)(t.p,{children:"As a result of these steps we will have a Global AdLib Action that when executed checks if the current part has any stepped graphics pieces and steps them until the last step."}),"\n",(0,c.jsx)(t.h2,{id:"step-1-add-a-new-actionid",children:"Step 1: Add a new ActionId"}),"\n",(0,c.jsx)(t.p,{children:"The first step is to come up with an identifier for your action. We just simply add it to the following enum:"}),"\n",(0,c.jsx)(t.pre,{children:(0,c.jsx)(t.code,{className:"language-typescript",children:"export enum ActionId {\n\tLastRemote = 'lastRemote',\n\tLastDVE = 'lastDVE',\n\t// added new id:\n\tGFXStep = 'GFXStep',\n}\n"})}),"\n",(0,c.jsx)(t.p,{children:(0,c.jsx)(t.code,{children:"packages\\blueprints\\src\\base\\showstyle\\executeActions\\actionDefinitions.ts"})}),"\n",(0,c.jsx)(t.h2,{id:"step-2-create-a-global-action-to-step-through-the-graphic",children:"Step 2: Create a global action to step through the graphic"}),"\n",(0,c.jsxs)(t.p,{children:["We now need to define the action in our blueprint, this happens in ",(0,c.jsx)(t.code,{children:"getGlobalActions()"}),". This function returns all global actions for the rundown."]}),"\n",(0,c.jsx)(t.p,{children:"An example of a simple Global AdLib Action"}),"\n",(0,c.jsx)(t.pre,{children:(0,c.jsx)(t.code,{className:"language-typescript",children:"{\n    actionId: ActionId.GFXStep,\n    userData: {},\n    userDataManifest: {},\n    display: {\n        label: t('Control Graphic Step'),\n        sourceLayerId: SourceLayer.GFX,\n        outputLayerId: getOutputLayerForSourceLayer(SourceLayer.GFX),\n    },\n    triggerModes: [],\n    externalId: ingestRundown.externalId,\n}\n"})}),"\n",(0,c.jsx)(t.p,{children:(0,c.jsx)(t.code,{children:"packages\\blueprints\\src\\base\\showstyle\\rundown\\globalActions.ts"})}),"\n",(0,c.jsx)(t.h2,{id:"step-3-execution-logic",children:"Step 3: Execution logic"}),"\n",(0,c.jsx)(t.p,{children:"Now we need to define what our action does, when we trigger it."}),"\n",(0,c.jsxs)(t.p,{children:["In ",(0,c.jsx)(t.code,{children:"executeAction()"})," we can forward our action to our execution logic:"]}),"\n",(0,c.jsx)(t.pre,{children:(0,c.jsx)(t.code,{className:"language-typescript",children:"if (actionId === ActionId.LastRemote) {\n\tawait executeLastOnSourceLayer(context, SourceLayer.Remote)\n} else if (actionId === ActionId.LastDVE) {\n\tawait executeLastOnSourceLayer(context, SourceLayer.DVE)\n}\n// Our new action is executed here:\nelse if (actionId === ActionId.GFXStep) {\n\tawait executeGraphicNextStep(context)\n}\n"})}),"\n",(0,c.jsx)(t.p,{children:(0,c.jsx)(t.code,{children:"packages/blueprints/src/base/showstyle/executeActions/index.ts"})}),"\n",(0,c.jsx)(t.p,{children:"And then we can have the actual logic in a separate function:"}),"\n",(0,c.jsx)(t.h3,{id:"for-our-example-we-could-choose-from-these-approaches",children:"For our example we could choose from these approaches:"}),"\n",(0,c.jsxs)(t.ol,{children:["\n",(0,c.jsxs)(t.li,{children:[(0,c.jsx)(t.code,{children:"context.updatePieceInstance()"}),"\n",(0,c.jsxs)(t.ul,{children:["\n",(0,c.jsxs)(t.li,{children:["update the current ",(0,c.jsx)(t.code,{children:"piece"})," and ",(0,c.jsx)(t.code,{children:"timeline object"})," (we used this in the example)"]}),"\n",(0,c.jsxs)(t.li,{children:["add new ",(0,c.jsx)(t.code,{children:"timeline objects"})," for each step execution, these are still part of the same ",(0,c.jsx)(t.code,{children:"piece"})]}),"\n",(0,c.jsxs)(t.li,{children:["add ",(0,c.jsx)(t.code,{children:"keyframes"})," to the already existing ",(0,c.jsx)(t.code,{children:"timeline object"})]}),"\n"]}),"\n"]}),"\n",(0,c.jsxs)(t.li,{children:[(0,c.jsx)(t.code,{children:"context.insertPiece()"})," to add a new ",(0,c.jsx)(t.code,{children:"piece"})," with the new step when advancing the graphic"]}),"\n"]}),"\n",(0,c.jsx)(t.p,{children:"Optionally a DataStoreAction can be used to fast-track the next slide instead of waiting for the database to update."}),"\n",(0,c.jsxs)(t.p,{children:["Relevant reading on Part and Piece actions: ",(0,c.jsx)(t.a,{href:"https://github.com/Sofie-Automation/sofie-core/blob/release53/packages/blueprints-integration/src/context/partsAndPieceActionContext.ts",children:"https://github.com/Sofie-Automation/sofie-core/blob/release53/packages/blueprints-integration/src/context/partsAndPieceActionContext.ts"})]}),"\n",(0,c.jsx)(t.pre,{children:(0,c.jsx)(t.code,{className:"language-typescript",children:"export async function executeGraphicNextStep(context: IActionExecutionContext): Promise<void> {\n\tconst increment = 1\n\n\t// we filter for any stepped graphic piece\n\tconst pieceInstances = await context.getPieceInstances('current')\n\tconst steppedPieceInstances = pieceInstances.filter(\n\t\t(piece) => (piece.piece.content as unknown as WithTimeline<NoraContent>).step\n\t)\n\n\t// we execute the action for each of them\n\tfor (const piece of steppedPieceInstances) {\n\t\tconst content = piece.piece.content as unknown as WithTimeline<NoraContent>\n\t\tif (content.step) {\n\t\t\tconst { count, current } = content.step\n\n\t\t\tnewStep = Math.min(newStep, count)\n\n\t\t\tawait context.updatePieceInstance(piece._id, {\n\t\t\t\t...piece.piece,\n\t\t\t\tcontent: {\n\t\t\t\t\t...content,\n\n\t\t\t\t\t// update step data\n\t\t\t\t\tstep: { ...content.step, current: newStep },\n\n\t\t\t\t\t/* If needed modify the timelineObjects too.\n\t\t\t\t\t\n\t\t\t\t\ttimelineObjects: content.timelineObjects.map((tlObj) => ({\n\t\t\t\t\t\t...tlObj,\n\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t...tlObj.content,\n\t\t\t\t\t\t\tdata: (tlObj.content as any).data\n\t\t\t\t\t\t\t\t? { ...(tlObj.content as any).data, currentStep: content.step ? newStep : undefined }\n\t\t\t\t\t\t\t\t: undefined,\n\t\t\t\t\t\t},\n\t\t\t\t\t})), */\n\t\t\t\t},\n\t\t\t})\n\t\t}\n\t}\n}\n"})}),"\n",(0,c.jsx)(t.p,{children:(0,c.jsx)(t.code,{children:"packages/blueprints/src/base/showstyle/executeActions/steppedGraphicExample.ts"})}),"\n",(0,c.jsx)(t.h2,{id:"result",children:"Result"}),"\n",(0,c.jsx)("img",{src:s})]})}function h(e={}){const{wrapper:t}={...(0,a.R)(),...e.components};return t?(0,c.jsx)(t,{...e,children:(0,c.jsx)(p,{...e})}):p(e)}},1184(e,t,n){n.d(t,{R:()=>s,x:()=>o});var i=n(4041);const c={},a=i.createContext(c);function s(e){const t=i.useContext(a);return i.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(c):e.components||c:s(e.components),i.createElement(a.Provider,{value:t},e.children)}}}]);